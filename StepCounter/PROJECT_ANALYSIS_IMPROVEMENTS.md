# üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ StepCounter –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** –¢–µ–∫—É—â–∞—è

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞](#–æ–±—â–∞—è-–æ—Ü–µ–Ω–∫–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
4. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
5. [–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞](#–∫–∞—á–µ—Å—Ç–≤–æ-–∫–æ–¥–∞)
6. [UX/UI —É–ª—É—á—à–µ–Ω–∏—è](#uxui-—É–ª—É—á—à–µ–Ω–∏—è)
7. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
8. [–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏](#–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ-–∑–∞–¥–∞—á–∏)

---

## üéØ –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

- **–•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MVVM –ø–∞—Ç—Ç–µ—Ä–Ω–∞ —Å ObservableObject
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Models –∏ Views
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: DataCoordinator –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫**: SwiftUI, Combine, async/await
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ weak references –≤ DataCoordinator

### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### ‚úÖ –ß—Ç–æ —Ö–æ—Ä–æ—à–æ

1. **–°–∏–Ω–≥–ª—Ç–æ–Ω—ã –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è SwiftUI
2. **DataCoordinator** - –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
3. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ Models/Views/Components

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### 1. Dependency Injection –¥–ª—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
```swift
// –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
protocol HealthManagerProtocol {
    var todaySteps: Int { get }
    func requestAuthorization()
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –≤ View
struct HomeView: View {
    @EnvironmentObject var healthManager: HealthManagerProtocol
}
```

#### 2. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** StorageManager —Å–º–µ—à–∏–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```swift
protocol StorageRepository {
    func save<T: Codable>(_ object: T, forKey: String) async throws
    func load<T: Codable>(_ type: T.Type, forKey: String) async throws -> T?
}

class UserDefaultsRepository: StorageRepository {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
}
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. StorageManager - –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ç–æ–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
func save<T: Codable>(_ object: T, forKey key: String) {
    DispatchQueue.global(qos: .utility).async {
        // ...
    }
}

// –ù–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–±—É–µ—Ç main thread
func saveString(_ value: String, forKey key: String) {
    assert(Thread.isMainThread, "must be called on main thread")
    // ...
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```swift
// –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ñ–æ–Ω–µ —Å async/await
func save<T: Codable>(_ object: T, forKey key: String) async throws {
    let encoder = JSONEncoder()
    encoder.outputFormatting = []
    let data = try encoder.encode(object)
    
    await MainActor.run {
        UserDefaults.standard.set(data, forKey: key)
    }
}

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–∫—Ç–æ—Ä –¥–ª—è thread-safety
actor StorageActor {
    func save<T: Codable>(_ object: T, forKey key: String) throws {
        let encoder = JSONEncoder()
        let data = try encoder.encode(object)
        UserDefaults.standard.set(data, forKey: key)
    }
}
```

#### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ onChange –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `StepCounterApp.swift` –º–Ω–æ–≥–æ `onChange` –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —á–∞—Å—Ç–æ

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```swift
.onChange(of: healthManager.todaySteps) { _, newValue in
    // ...
}
.onChange(of: healthManager.weeklySteps.count) { _, _ in
    // ...
}
.onChange(of: healthManager.isGoalReached) { _, reached in
    // ...
}
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Combine –¥–ª—è –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞
```swift
// –í HealthManager
@Published var todaySteps: Int = 0 {
    didSet {
        stepsSubject.send(todaySteps)
    }
}

private let stepsSubject = PassthroughSubject<Int, Never>()
var debouncedSteps: AnyPublisher<Int, Never> {
    stepsSubject
        .debounce(for: .milliseconds(500), scheduler: DispatchQueue.main)
        .eraseToAnyPublisher()
}
```

#### 3. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —à–∞–≥–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –ë–∞—Ç—á–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
```swift
class DataCoordinator {
    private var updateQueue: [UpdateTask] = []
    private var updateTimer: Timer?
    
    func scheduleUpdate(_ task: UpdateTask) {
        updateQueue.append(task)
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞—Ç—á–∞–º–∏ –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥—ã
        updateTimer?.invalidate()
        updateTimer = Timer.scheduledTimer(withTimeInterval: 0.5, repeats: false) { [weak self] _ in
            self?.processBatchUpdates()
        }
    }
}
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 4. –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```swift
class LevelManager {
    @Published private(set) var dailyQuests: [DailyQuest] = []
    private var questsLoaded = false
    
    func loadQuestsIfNeeded() {
        guard !questsLoaded else { return }
        loadQuests()
        questsLoaded = true
    }
}
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
// StorageManager.swift
func save<T: Codable>(_ object: T, forKey key: String) {
    DispatchQueue.global(qos: .utility).async {
        do {
            // ...
        } catch {
            print("StorageManager.save encoding error: \(error)") // –¢–æ–ª—å–∫–æ print!
        }
    }
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```swift
enum StorageError: LocalizedError {
    case encodingFailed(Error)
    case decodingFailed(Error)
    case keyNotFound(String)
    
    var errorDescription: String? {
        switch self {
        case .encodingFailed(let error):
            return "–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è: \(error.localizedDescription)"
        // ...
        }
    }
}

func save<T: Codable>(_ object: T, forKey key: String) async throws {
    do {
        let encoder = JSONEncoder()
        let data = try encoder.encode(object)
        await MainActor.run {
            UserDefaults.standard.set(data, forKey: key)
        }
    } catch {
        throw StorageError.encodingFailed(error)
    }
}
```

#### 2. Force unwrap –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—Å–µ `!` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `guard let` –∏–ª–∏ `if let` –≤–µ–∑–¥–µ

#### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –∏–∑ HealthKit –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```swift
func fetchTodaySteps() {
    // ...
    let steps = result.sumQuantity()?.doubleValue(for: .count()) ?? 0
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    guard steps >= 0 && steps <= 1_000_000 else {
        errorMessage = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —à–∞–≥–æ–≤"
        return
    }
    
    todaySteps = Int(steps)
}
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `print()`

**–†–µ—à–µ–Ω–∏–µ:** –í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```swift
enum LogLevel {
    case debug, info, warning, error
}

class Logger {
    static func log(_ message: String, level: LogLevel = .info) {
        #if DEBUG
        print("[\(level)] \(message)")
        #else
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Crashlytics –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å
        #endif
    }
}
```

---

## üìù –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–ù–∞–π–¥–µ–Ω–æ:**
- `HealthInsightsView.swift:217` - TODO: –ø–æ–ª—É—á–∏—Ç—å streak –∏–∑ AchievementManager
- `PublicLeaderboardView.swift:66` - TODO: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Firebase/—Å–µ—Ä–≤–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ö–æ–∂–∏–µ view –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä:** GlassCard –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ, –Ω–æ —Å—Ç–∏–ª–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```swift
struct StandardGlassCard<Content: View>: View {
    let content: Content
    
    var body: some View {
        GlassCard(cornerRadius: 20, padding: 20) {
            content
        }
    }
}
```

#### 3. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
if steps >= 10000 { bonusXP += 20 }
if steps >= 15000 { bonusXP += 30 }
```

**–†–µ—à–µ–Ω–∏–µ:**
```swift
enum StepMilestone: Int {
    case tenThousand = 10_000
    case fifteenThousand = 15_000
    case twentyThousand = 20_000
    
    var xpBonus: Int {
        switch self {
        case .tenThousand: return 20
        case .fifteenThousand: return 30
        case .twentyThousand: return 50
        }
    }
}
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API
```swift
/// –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HealthKit –¥–∞–Ω–Ω—ã–º–∏
/// 
/// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
/// ```swift
/// let manager = HealthManager()
/// await manager.requestAuthorization()
/// ```
final class HealthManager: ObservableObject {
    // ...
}
```

#### 5. –î–ª–∏–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ (>50 —Å—Ç—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–µ–Ω—å—à–∏–µ –º–µ—Ç–æ–¥—ã

---

## üé® UX/UI —É–ª—É—á—à–µ–Ω–∏—è

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∑–∞–≥—Ä—É–∑–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```swift
enum LoadingState {
    case idle
    case loading
    case loaded
    case error(Error)
}

@Published var loadingState: LoadingState = .idle
```

#### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å EmptyStateView –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–ø–∏—Å–∫–æ–≤

#### 3. –ê–Ω–∏–º–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–ª–∞–≤–Ω–µ–µ

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã–µ easing —Ñ—É–Ω–∫—Ü–∏–∏

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ:**
```swift
class HealthManager {
    private var cachedWeeklySteps: [DailyStepData]?
    private var cacheDate: Date?
    
    func getWeeklySteps() -> [DailyStepData] {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        if let cached = cachedWeeklySteps,
           let date = cacheDate,
           Date().timeIntervalSince(date) < 300 { // 5 –º–∏–Ω—É—Ç
            return cached
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
        let data = fetchWeeklySteps()
        cachedWeeklySteps = data
        cacheDate = Date()
        return data
    }
}
```

### 2. –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `lazy` –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º–∏

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ä–∞–∑–º–µ—Ä–∞

---

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

### üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å StorageManager** - —É–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ç–æ–∫–æ–≤
2. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - –≤–µ–∑–¥–µ, –≥–¥–µ –µ—Å—Ç—å try/catch
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO** - –∑–∞–≤–µ—Ä—à–∏—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö** - –¥–ª—è HealthKit –¥–∞–Ω–Ω—ã—Ö

### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å onChange** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥
6. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
7. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–º–µ–Ω–∏—Ç—å print –Ω–∞ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
8. **–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** - –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API

### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

9. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
10. **–£–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
11. **–î–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - –¥–ª—è –ª—É—á—à–µ–≥–æ UX
12. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏** - —Å–¥–µ–ª–∞—Ç—å –∏—Ö –ø–ª–∞–≤–Ω–µ–µ

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** 0% (–Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** ~30% (–±–∞–∑–æ–≤–∞—è)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** ~40% (—á–∞—Å—Ç–∏—á–Ω–∞—è)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** 60%+
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 80%+
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** 90%+
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

---

## üîß –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: StorageManager

```swift
// –ë—ã–ª–æ:
func save<T: Codable>(_ object: T, forKey key: String) {
    DispatchQueue.global(qos: .utility).async {
        // ...
    }
}

// –°—Ç–∞–ª–æ:
@MainActor
func save<T: Codable>(_ object: T, forKey key: String) async throws {
    let encoder = JSONEncoder()
    encoder.outputFormatting = []
    let data = try encoder.encode(object)
    UserDefaults.standard.set(data, forKey: key)
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ onChange

```swift
// –í HealthManager
private let stepsSubject = PassthroughSubject<Int, Never>()
var debouncedSteps: AnyPublisher<Int, Never> {
    stepsSubject
        .debounce(for: .milliseconds(500), scheduler: DispatchQueue.main)
        .eraseToAnyPublisher()
}

// –í StepCounterApp
.onReceive(healthManager.debouncedSteps) { steps in
    DataCoordinator.shared.onStepsChanged(...)
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Swift Concurrency Best Practices](https://developer.apple.com/documentation/swift/concurrency)
- [SwiftUI Performance](https://developer.apple.com/videos/play/wwdc2021/10022/)
- [Error Handling in Swift](https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html)

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
