# üìã –û—Ç—á–µ—Ç –ø–æ –∞—É–¥–∏—Ç—É –∫–æ–¥–∞ ChallengeApp

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 24 —è–Ω–≤–∞—Ä—è 2026  
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 24 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** MVP / Production Ready  
**–ê—É–¥–∏—Ç–æ—Ä:** AI Code Reviewer (Swift Expert)

## ‚úÖ –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 6 –∏–∑ 8 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ –≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #1:** –í—ã–Ω–µ—Å–µ–Ω—ã hardcoded —Å–µ–∫—Ä–µ—Ç—ã –≤ `.xcconfig` —Ñ–∞–π–ª—ã
- ‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #2:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã race conditions —á–µ—Ä–µ–∑ `@MainActor`
- ‚úÖ **–í–∞–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #5:** –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç
- ‚úÖ **–í–∞–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #6:** –í—ã–Ω–µ—Å–µ–Ω—ã –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- ‚úÖ **–ú–µ–ª–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #7:** –£–±—Ä–∞–Ω—ã TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ debug –∫–æ–¥
- ‚úÖ **–ú–µ–ª–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #8:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

### –û—Å—Ç–∞–ª–æ—Å—å (—Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏):
- ‚è≥ **–í–∞–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #3-4:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ SupabaseManager (2-3 –¥–Ω—è —Ä–∞–±–æ—Ç—ã)

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) | –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ –µ—Å—Ç—å –º–µ—Å—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è |
| **–ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞** | ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) | –í —Ü–µ–ª–æ–º —á–∏—Å—Ç—ã–π –∫–æ–¥, –Ω–æ –µ—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê (3/5) | –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∞—Å—Å—ã —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ, –Ω—É–∂–Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) | –•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –Ω–æ –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê (3/5) | Hardcoded –∫–ª—é—á–∏, –Ω—É–∂–Ω–∞ —É–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê (3/5) | –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –µ—Å—Ç—å, –Ω–æ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 3.7/5** ‚≠ê‚≠ê‚≠ê‚≠ê

---

## ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

‚úÖ **Dependency Injection —á–µ—Ä–µ–∑ DIContainer**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (`SupabaseManagerProtocol`, `AuthManagerProtocol`, etc.)
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å

‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
- `Managers/` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `Views/` - UI
- `Models/` - –¥–∞–Ω–Ω—ã–µ
- `Utils/` - —É—Ç–∏–ª–∏—Ç—ã

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- `Logger.swift` —Å —É—Ä–æ–≤–Ω—è–º–∏ (debug, info, warning, error, critical)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OSLog –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –£–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ª–æ–≥–æ–≤

‚úÖ **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- `AppError` enum —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
- `ErrorHandler` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 2. –°–µ—Ç–µ–≤–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

‚úÖ **Retry –ª–æ–≥–∏–∫–∞**
- `NetworkRetry` —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CancellationError
- –ü—Ä–æ–≤–µ—Ä–∫–∞ retryable –æ—à–∏–±–æ–∫

‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–∞–º—è—Ç—å + –¥–∏—Å–∫)
- TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Å—Å–∏–π**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- Fallback –Ω–∞ –∫—ç—à –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. Hardcoded —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `AppConfig.swift:25-42`

```swift
static let supabaseURL: String = {
    // ...
    return "https://qvyxkbeafgarcjjppttd.supabase.co"  // ‚ö†Ô∏è Hardcoded
}()

static let supabaseKey: String = {
    // ...
    return "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  // ‚ö†Ô∏è Hardcoded –∫–ª—é—á
}()
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ
- –†–∏—Å–∫ —É—Ç–µ—á–∫–∏ –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ Git
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.xcconfig` —Ñ–∞–π–ª—ã (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è YooKassa)
- ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –≤ `Info.plist` —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è CI/CD
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore` –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –∫–ª—é—á–∞–º–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

#### 2. –û–≥—Ä–æ–º–Ω—ã–π –∫–ª–∞—Å—Å SupabaseManager (1932 —Å—Ç—Ä–æ–∫–∏)

**–§–∞–π–ª:** `SupabaseManager.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle
- –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–µ

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–ª–∞—Å—Å:**
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (signUp, signIn, signInWithApple, etc.)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (getUserProfile, updateUserAvatar)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º (depositBalance, withdrawBalance)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞–º–∏ (getChallenges, joinChallenge, completeDay, failChallenge)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π (getCompletedTodayCount, getFailedTodayCount)
- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (getUserPayments, getBalanceStatus)
- –ß–µ—Å—Ç–Ω–∞—è —Å–µ—Ä–∏—è (incrementHonestStreak, resetHonestStreak)

**–†–µ—à–µ–Ω–∏–µ:**
–†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:

```swift
// AuthManager (—É–∂–µ –µ—Å—Ç—å, –Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
- signUp, signIn, signInWithApple, signOut, getCurrentUser

// UserManager (–Ω–æ–≤—ã–π)
- getUserProfile, updateUserAvatar, updateUserSettings

// BalanceManager (–Ω–æ–≤—ã–π)
- depositBalance, withdrawBalance, getBalanceStatus, getPendingDepositCreatedAt

// ChallengeDataManager (–Ω–æ–≤—ã–π)
- getChallenges, getChallenge, getUserChallenges, getActiveChallenge
- getCompletedTodayCount, getFailedTodayCount

// ChallengeActionManager (–Ω–æ–≤—ã–π)
- joinChallenge, completeDay, failChallenge

// PaymentHistoryManager (–Ω–æ–≤—ã–π)
- getUserPayments

// HonestStreakManager (–Ω–æ–≤—ã–π)
- incrementHonestStreak, resetHonestStreak
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

#### 3. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions

**–§–∞–π–ª:** `ChallengeManager.swift:298-407`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
func completeDay(for userChallenge: UserChallenge) async throws {
    // 1. –í—ã–∑—ã–≤–∞–µ–º Supabase
    try await supabaseManager.completeDay(challengeId: challengeId)
    
    // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    let updatedUserChallenges = try await supabaseManager.getUserChallenges()
    
    // 3. –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    await MainActor.run {
        self.userChallenges = updatedUserChallenges
        // ...
    }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
- –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ù–µ—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UI

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `actor` –¥–ª—è ChallengeManager
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@MainActor` –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 4. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç

**–§–∞–π–ª—ã:** `SupabaseManager.swift`, `Challenge.swift`, `User.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ISO8601DateFormatter —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Å/–±–µ–∑ fractional seconds)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä:**
```swift
// –í SupabaseManager.swift:1756-1764
func toCreatedDate() -> Date {
    let formatter = ISO8601DateFormatter()
    formatter.formatOptions = [.withInternetDateTime, .withFractionalSeconds]
    if let date = formatter.date(from: createdAt) {
        return date
    }
    formatter.formatOptions = [.withInternetDateTime]
    return formatter.date(from: createdAt) ?? Date()
}

// –í ChallengeResponse:1808-1812
private func parseDate(_ dateString: String) -> Date {
    return Self.iso8601Formatter.date(from: dateString)
        ?? Self.iso8601FormatterNoFraction.date(from: dateString)
        ?? Date()
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `DateFormatter` —É—Ç–∏–ª–∏—Ç—É:

```swift
// Utils/DateFormatter+Extensions.swift
extension ISO8601DateFormatter {
    static let flexible: ISO8601DateFormatter = {
        let formatter = ISO8601DateFormatter()
        formatter.formatOptions = [.withInternetDateTime, .withFractionalSeconds]
        return formatter
    }()
    
    static func parse(_ string: String) -> Date? {
        return flexible.date(from: string) 
            ?? ISO8601DateFormatter().date(from: string)
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 5. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `CacheManager.swift`

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–î–≤–æ–π–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```swift
   // –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: T -> Data -> CacheEntry -> Data
   // –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏: Data -> CacheEntry -> Data -> T
   ```

2. **–ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏:**
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ
   - –ù–µ—Ç LRU/LFU —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

3. **–ù–µ—Ç –º–µ—Ç—Ä–∏–∫:**
   - –ù–µ–ª—å–∑—è –æ—Ç—Å–ª–µ–¥–∏—Ç—å hit/miss ratio
   - –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—ç—à–∞
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å LRU –¥–ª—è –ø–∞–º—è—Ç–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 6. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ª–æ–≥–∏–∫–∏ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
- –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
- ‚úÖ `AuthManager` - –µ—Å—Ç—å —Ç–µ—Å—Ç—ã
- ‚úÖ `ChallengeManager` - –µ—Å—Ç—å —Ç–µ—Å—Ç—ã
- ‚ùå `PaymentManager` - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚ùå `SupabaseManager` - –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã, –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
- ‚ùå `ErrorHandler` - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤
- ‚ùå `CacheManager` - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 7. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

**–§–∞–π–ª:** `AuthManager.swift:17`

```swift
private var currentAppleSignInContinuation: CheckedContinuation<User?, Never>?
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Continuation –º–æ–∂–µ—Ç –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```swift
defer {
    currentAppleSignInContinuation = nil
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

### üü¢ –ú–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 8. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞

**–ü—Ä–∏–º–µ—Ä—ã:**
- `500_000_000` (0.5 —Å–µ–∫—É–Ω–¥—ã) - `ChallengeManager.swift:219`
- `2_000_000_000` (2 —Å–µ–∫—É–Ω–¥—ã) - `PaymentManager.swift:185`
- `30` (–º–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫) - `PaymentManager.swift:357`

**–†–µ—à–µ–Ω–∏–µ:**
–í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
```swift
enum TimingConstants {
    static let shortDelay: TimeInterval = 0.5
    static let defaultDelay: TimeInterval = 2.0
    static let paymentPollingMaxAttempts = 30
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 9. TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–ù–∞–π–¥–µ–Ω–æ:**
- `Logger.swift:66` - TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `PaymentManager.swift:199` - –°–∏–º—É–ª—è—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –æ—à–∏–±–æ–∫ (10% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å) - –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —É–±—Ä–∞—Ç—å!

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ issue tracker
- –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO
- –£–±—Ä–∞—Ç—å debug-–∫–æ–¥ –∏–∑ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 10. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥

**–§–∞–π–ª:** `DIContainer.swift:57-63`

```swift
#if DEBUG
/// –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–∞ –º–æ–∫–∏
func setSupabaseManager(_ manager: any SupabaseManagerProtocol) {
    // –í —Ç–µ—Å—Ç–∞—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –¥–ª—è –∏–Ω–∂–µ–∫—Ü–∏–∏ –º–æ–∫–æ–≤
    // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —ç—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
}
#endif
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∞, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –í–≤–æ–¥–∏—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

### 1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ SupabaseManager

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- 1932 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
- 10+ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π

**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**

```
Phase 1: –í—ã–¥–µ–ª–∏—Ç—å UserManager
‚îú‚îÄ‚îÄ getUserProfile
‚îú‚îÄ‚îÄ updateUserAvatar
‚îî‚îÄ‚îÄ updateUserSettings (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

Phase 2: –í—ã–¥–µ–ª–∏—Ç—å BalanceManager
‚îú‚îÄ‚îÄ depositBalance
‚îú‚îÄ‚îÄ withdrawBalance
‚îú‚îÄ‚îÄ getBalanceStatus
‚îî‚îÄ‚îÄ getPendingDepositCreatedAt

Phase 3: –í—ã–¥–µ–ª–∏—Ç—å ChallengeDataManager
‚îú‚îÄ‚îÄ getChallenges
‚îú‚îÄ‚îÄ getChallenge
‚îú‚îÄ‚îÄ getUserChallenges
‚îú‚îÄ‚îÄ getActiveChallenge
‚îú‚îÄ‚îÄ getCompletedTodayCount
‚îî‚îÄ‚îÄ getFailedTodayCount

Phase 4: –í—ã–¥–µ–ª–∏—Ç—å ChallengeActionManager
‚îú‚îÄ‚îÄ joinChallenge
‚îú‚îÄ‚îÄ completeDay
‚îî‚îÄ‚îÄ failChallenge

Phase 5: –í—ã–¥–µ–ª–∏—Ç—å PaymentHistoryManager
‚îî‚îÄ‚îÄ getUserPayments

Phase 6: –í—ã–¥–µ–ª–∏—Ç—å HonestStreakManager
‚îú‚îÄ‚îÄ incrementHonestStreak
‚îî‚îÄ‚îÄ resetHonestStreak
```

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 –¥–Ω—è

---

### 2. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –•–æ—Ä–æ—à–∞—è –±–∞–∑–∞ (AppError, ErrorHandler)
- ‚ö†Ô∏è –ù–æ –Ω–µ –≤—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ

**–£–ª—É—á—à–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å retry —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å circuit breaker –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫ (Sentry/Firebase Crashlytics)

---

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **N+1 –∑–∞–ø—Ä–æ—Å—ã:**
   ```swift
   // –í getChallenges() –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞ –¥–µ–ª–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   for challengeResponse in response {
       let completedToday = try await getCompletedTodayCount(challengeId: challengeResponse.id)
       let failedToday = try await getFailedTodayCount(challengeId: challengeResponse.id)
   }
   ```

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏:**
   - –í—Å–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É
   - –ü—Ä–∏ —Ä–æ—Å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –±—É–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch –∑–∞–ø—Ä–æ—Å—ã
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GraphQL –∏–ª–∏ RPC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

### 4. –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è DI
- ‚ö†Ô∏è –ù–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∞—Å—Å—ã —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑-–∑–∞ —Ä–∞–∑–º–µ—Ä–∞

**–£–ª—É—á—à–µ–Ω–∏—è:**
1. –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã (—Å–º. —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ SupabaseManager)
2. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ unit-—Ç–µ—Å—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö flow
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å snapshot —Ç–µ—Å—Ç—ã –¥–ª—è UI

---

## üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

‚úÖ **–£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:**
- `.xcconfig` —Ñ–∞–π–ª—ã –¥–ª—è YooKassa
- `.gitignore` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

‚ùå **–ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- –í—ã–Ω–µ—Å—Ç–∏ Supabase –∫–ª—é—á–∏ –≤ `.xcconfig`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Keychain –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª–µ–π
- –ù–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:**
```swift
// Utils/Validation.swift
struct Validator {
    static func validateEmail(_ email: String) -> Bool {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
    }
    
    static func validateAmount(_ amount: Double) -> Bool {
        return amount > 0 && amount <= 1000000
    }
}
```

---

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```swift
Logger.shared.info("Session accessToken prefix: \(session.accessToken.prefix(20))...")
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –¥–∞–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ CI/CD –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –ª–æ–≥–∞—Ö

---

## üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è)

### –ù–µ–¥–µ–ª—è 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–í—ã–Ω–µ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –∫–æ–¥–∞** (1 –¥–µ–Ω—å)
   - –°–æ–∑–¥–∞—Ç—å `.xcconfig` –¥–ª—è Supabase
   - –û–±–Ω–æ–≤–∏—Ç—å `AppConfig.swift`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `.gitignore`

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å race conditions** (2 –¥–Ω—è)
   - –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ `ChallengeManager` –Ω–∞ `actor`
   - –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ù–µ–¥–µ–ª—è 2: –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ SupabaseManager** (3 –¥–Ω—è)
   - Phase 1-2: UserManager, BalanceManager
   - Phase 3-4: ChallengeDataManager, ChallengeActionManager
   - –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

4. **–£–ª—É—á—à–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (1 –¥–µ–Ω—å)
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—ç—à–∞
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏

### –ù–µ–¥–µ–ª—è 3: –£–ª—É—á—à–µ–Ω–∏—è

5. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** (2 –¥–Ω—è)
   - PaymentManager —Ç–µ—Å—Ç—ã
   - ErrorHandler —Ç–µ—Å—Ç—ã
   - CacheManager —Ç–µ—Å—Ç—ã

6. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (2 –¥–Ω—è)
   - Batch –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è —Å–ø–∏—Å–∫–æ–≤

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

### –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|------------------|
| –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∫–ª–∞—Å—Å–∞ | ~400 —Å—Ç—Ä–æ–∫ | < 300 —Å—Ç—Ä–æ–∫ |
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–ª–∞—Å—Å–∞ | 1932 —Å—Ç—Ä–æ–∫–∏ | < 500 —Å—Ç—Ä–æ–∫ |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | ~30% | > 70% |
| –¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | ~5% | < 3% |

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—á–µ—Ä–µ–∑ 1 –º–µ—Å—è—Ü)

- ‚úÖ –í—Å–µ –∫–ª–∞—Å—Å—ã < 500 —Å—Ç—Ä–æ–∫
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 60%
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ < 3%
- ‚úÖ –ù–µ—Ç hardcoded —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –í—Å–µ TODO —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã

---

## üéì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ best practices

### 1. Swift Concurrency

‚úÖ **–£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `async/await`
- `Task`
- `@MainActor`

‚ö†Ô∏è **–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `actor` –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –î–æ–±–∞–≤–∏—Ç—å `Sendable` –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –≥–¥–µ –Ω—É–∂–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TaskGroup` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

### 2. Error Handling

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `AppError`
- `ErrorHandler` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

‚ö†Ô∏è **–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å structured logging –¥–ª—è –æ—à–∏–±–æ–∫
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (Sentry)

---

### 3. Code Organization

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫
- MARK –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

‚ö†Ô∏è **–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:**
- –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å extensions –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å DI
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å retry
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- üî¥ Hardcoded —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ
- üü° –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã (SupabaseManager)
- üü° –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions
- üü° –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –∫–æ–¥–∞
2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å SupabaseManager –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
3. –£–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (batch –∑–∞–ø—Ä–æ—Å—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è)

**–í–µ—Ä–¥–∏–∫—Ç:** –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (hardcoded —Å–µ–∫—Ä–µ—Ç—ã). –î–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ —É–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** AI Code Reviewer  
**–î–∞—Ç–∞:** 24 —è–Ω–≤–∞—Ä—è 2026
