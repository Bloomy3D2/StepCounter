# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –¥–ª—è Challenge App

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Supabase

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –ù–∞–∂–º–∏—Ç–µ "Start your project"
3. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ GitHub (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç)
4. –ù–∞–∂–º–∏—Ç–µ "New Project"
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Name**: `challenge-app`
   - **Database Password**: (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å!)
   - **Region**: –≤—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π
6. –ù–∞–∂–º–∏—Ç–µ "Create new project"
7. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è

---

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **SQL Editor**
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase/schema.sql`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å SQL –∫–æ–¥
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
5. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Cmd+Enter)
6. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Success. No rows returned"

---

## –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Settings** ‚Üí **API**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Project URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://xxxxx.supabase.co`)
   - **anon public** key (–¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è - –æ–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–ª—è iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Authentication** ‚Üí **Providers**
2. –í–∫–ª—é—á–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:
   - ‚úÖ **Email** (—É–∂–µ –≤–∫–ª—é—á–µ–Ω)
   - ‚úÖ **Apple** (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω Sign in with Apple)
   - ‚úÖ **Google** (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω Google Sign-In)

### –î–ª—è Apple Sign-In:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Apple Developer](https://developer.apple.com)
2. –°–æ–∑–¥–∞–π—Ç–µ Service ID
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ callback URL: `https://YOUR_PROJECT.supabase.co/auth/v1/callback`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client ID –∏ Secret –≤ Supabase

---

## –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Supabase CLI (–¥–ª—è Edge Functions)

```bash
# macOS
brew install supabase/tap/supabase

# –ò–ª–∏ —á–µ—Ä–µ–∑ npm
npm install -g supabase
```

---

## –®–∞–≥ 6: –î–µ–ø–ª–æ–π Edge Functions

```bash
# –í–æ–π–¥–∏—Ç–µ –≤ Supabase
supabase login

# –°–≤—è–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
supabase link --project-ref YOUR_PROJECT_REF

# –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π
cd supabase/edge-functions

supabase functions deploy join-challenge
supabase functions deploy complete-day
supabase functions deploy fail-challenge
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Dashboard:**
1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Edge Functions**
2. –ù–∞–∂–º–∏—Ç–µ **Create a new function**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ `edge-functions/join-challenge/index.ts`
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

## –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ `ChallengeApp/Managers/SupabaseManager.swift`
2. –ó–∞–º–µ–Ω–∏—Ç–µ:
   ```swift
   guard let url = URL(string: "YOUR_SUPABASE_URL"),
         let key = "YOUR_SUPABASE_ANON_KEY" as String? else {
   ```
   –ù–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   ```swift
   guard let url = URL(string: "https://xxxxx.supabase.co"),
         let key = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." as String? else {
   ```

---

## –®–∞–≥ 8: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Supabase Swift SDK

### –ß–µ—Ä–µ–∑ Swift Package Manager:

1. –í Xcode: **File** ‚Üí **Add Packages...**
2. –í—Å—Ç–∞–≤—å—Ç–µ URL: `https://github.com/supabase/supabase-swift`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é: `2.0.0` –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é
4. –î–æ–±–∞–≤—å—Ç–µ –≤ target: **ChallengeApp**

### –ò–ª–∏ —á–µ—Ä–µ–∑ Package.swift:

```swift
dependencies: [
    .package(url: "https://github.com/supabase/supabase-swift", from: "2.0.0")
]
```

---

## –®–∞–≥ 9: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

–ó–∞–º–µ–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–∞ Supabase –≤–µ—Ä—Å–∏–∏:

### AuthManager:
```swift
// –í–º–µ—Å—Ç–æ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
let user = try await SupabaseManager.shared.signIn(email: email, password: password)
```

### ChallengeManager:
```swift
// –í–º–µ—Å—Ç–æ UserDefaults –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
let challenges = try await SupabaseManager.shared.getChallenges()
```

---

## –®–∞–≥ 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª—Å—è –≤ Supabase:
   - **Authentication** ‚Üí **Users**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂–∏
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ **Table Editor** ‚Üí **challenges**

---

## –®–∞–≥ 11: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–í SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏
INSERT INTO public.challenges (
    title, subtitle, icon, duration, entry_fee,
    start_date, end_date, description, is_active
) VALUES 
(
    '–ü–æ–¥—ä—ë–º –¥–æ 7:00',
    '7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',
    'sunrise.fill',
    7,
    10.0,
    NOW() + INTERVAL '1 day',
    NOW() + INTERVAL '8 days',
    '–ü—Ä–æ—Å—ã–ø–∞–π—Å—è –¥–æ 7:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏',
    true
),
(
    '10,000 —à–∞–≥–æ–≤',
    '14 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',
    'figure.walk',
    14,
    20.0,
    NOW() + INTERVAL '1 day',
    NOW() + INTERVAL '15 days',
    '–ü—Ä–æ—Ö–æ–¥–∏ –º–∏–Ω–∏–º—É–º 10,000 —à–∞–≥–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å',
    true
),
(
    '–ë–µ–∑ —Å–æ—Ü—Å–µ—Ç–µ–π',
    '30 –¥–Ω–µ–π',
    'hand.raised.fill',
    30,
    50.0,
    NOW() + INTERVAL '1 day',
    NOW() + INTERVAL '31 days',
    '–ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π –Ω–∞ –º–µ—Å—è—Ü',
    true
);

-- –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞
INSERT INTO public.challenge_rules (challenge_id, rule, order_index)
SELECT id, '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –æ—Ç–º–µ—á–∞–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', 1 FROM public.challenges WHERE title = '–ü–æ–¥—ä—ë–º –¥–æ 7:00'
UNION ALL
SELECT id, '–ù–µ—Ç –æ—Ç–º–µ—Ç–∫–∏ = –≤—ã–ª–µ—Ç', 2 FROM public.challenges WHERE title = '–ü–æ–¥—ä—ë–º –¥–æ 7:00'
UNION ALL
SELECT id, '–î–µ–Ω—å–≥–∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è', 3 FROM public.challenges WHERE title = '–ü–æ–¥—ä—ë–º –¥–æ 7:00';
```

---

## –®–∞–≥ 12: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–≤–∞–ª–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å:

1. –í SQL Editor —Å–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é:
```sql
-- –§—É–Ω–∫—Ü–∏—è —É–∂–µ –µ—Å—Ç—å –≤ schema.sql
-- –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cron

-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pg_cron extension (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
CREATE EXTENSION IF NOT EXISTS pg_cron;

-- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞–¥–∞—á—É (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å UTC)
SELECT cron.schedule(
    'check-failed-challenges',
    '0 0 * * *', -- –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00
    $$SELECT check_failed_challenges()$$
);
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –í Supabase Dashboard:

1. **Table Editor** ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã:
   - `users` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - `challenges` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂–∏
   - `user_challenges` - –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏

2. **Authentication** ‚Üí **Users** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **Edge Functions** ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π

4. **Database** ‚Üí **Functions** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

---

## Troubleshooting

### –û—à–∏–±–∫–∞: "relation does not exist"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ `schema.sql`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ **Table Editor**

### –û—à–∏–±–∫–∞: "permission denied"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS policies
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

### –û—à–∏–±–∫–∞: "function does not exist"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –≤ **Database** ‚Üí **Functions**

### Edge Functions –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ **Edge Functions** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é ‚Üí **Logs**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—á–µ—Ä–µ–∑ Supabase –∏–ª–∏ FCM)
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (Stripe)
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –±—ç–∫–∞–ø—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ Pro –ø–ª–∞–Ω–µ)

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Supabase Docs](https://supabase.com/docs)
- [Supabase Swift SDK](https://github.com/supabase/supabase-swift)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [Edge Functions Docs](https://supabase.com/docs/guides/functions)

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è!
