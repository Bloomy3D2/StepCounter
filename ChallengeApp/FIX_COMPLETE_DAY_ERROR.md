# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "–í—ã–ø–æ–ª–Ω–∏–ª" –ø–æ—Å–ª–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —á–µ–ª–ª–µ–Ω–¥–∂

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –∏ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —á–µ–ª–ª–µ–Ω–¥–∂ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–Ω—è. –û—à–∏–±–∫–∞ 400 –æ—Ç Edge Function `complete-day`.

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. `entry_date` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `user_challenges` (—Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `DEFAULT NOW()`)
2. –ß–µ–ª–µ–Ω–¥–∂ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è (start_date > NOW())
3. –î–µ–Ω—å —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω (–¥—É–±–ª–∏–∫–∞—Ç –∑–∞–ø—Ä–æ—Å–∞)

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏—é `join_challenge`

–£–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ `schema.sql` - `entry_date` —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —è–≤–Ω–æ:
```sql
INSERT INTO public.user_challenges (user_id, challenge_id, is_active, entry_date)
VALUES (p_user_id, p_challenge_id, true, NOW())
```

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤ Supabase SQL Editor:

```sql
-- –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ user_challenges, –≥–¥–µ entry_date NULL
UPDATE public.user_challenges
SET entry_date = COALESCE(entry_date, created_at, NOW())
WHERE entry_date IS NULL;
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç—å Edge Function

Edge Function —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ:

```bash
cd ChallengeAppBackend/supabase
supabase functions deploy complete-day
```

---

## üîç –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –í SQL —Ñ—É–Ω–∫—Ü–∏–∏ `join_challenge`:
- ‚úÖ `entry_date` —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —è–≤–Ω–æ: `entry_date = NOW()`
- ‚úÖ –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

### –í Edge Function `complete-day`:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º SQL —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è `user_challenge` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—ã–ø–æ–ª–Ω–µ–Ω –ª–∏ –¥–µ–Ω—å —É–∂–µ —Å–µ–≥–æ–¥–Ω—è
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ—Ç SQL —Ñ—É–Ω–∫—Ü–∏–∏

### –í Swift –∫–æ–¥–µ:
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ Edge Function
- ‚úÖ –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂** –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
2. **–û–ø–ª–∞—Ç–∏—Ç–µ –∏ –≤—Å—Ç—É–ø–∏—Ç–µ** –≤ —á–µ–ª–ª–µ–Ω–¥–∂
3. **–ù–∞–∂–º–∏—Ç–µ "–í—ã–ø–æ–ª–Ω–∏–ª"** - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

–í –ª–æ–≥–∞—Ö Edge Function –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üì• Complete day request: userId=..., challengeId=...
üìã User challenge info: { id: ..., is_active: true, entry_date: ... }
‚úÖ complete_day RPC success: { completed_days: 1, ... }
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è, –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ:
- –¢–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç SQL —Ñ—É–Ω–∫—Ü–∏–∏
- –î–µ—Ç–∞–ª–∏ `user_challenge` (entry_date, is_active, –∏ —Ç.–¥.)
- –ü—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **entry_date:** –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `user_challenge`
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** Edge Function –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. **–û—à–∏–±–∫–∏:** –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Ç–µ–ø–µ—Ä—å –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-23  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
