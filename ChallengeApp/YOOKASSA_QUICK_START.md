# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –ÆKassa

## –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (5 –º–∏–Ω—É—Ç)

### 1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [yookassa.ru](https://yookassa.ru)
2. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
3. –í–∫–ª—é—á–∏—Ç–µ **"–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º"** (Sandbox)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **testShopId** –∏ **testSecretKey**

### 2. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á–∏ –≤ –∫–æ–¥

–û—Ç–∫—Ä–æ–π—Ç–µ `YooKassaClient.swift` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:

```swift
self.shopId = shopId ?? "–í–ê–®_TEST_SHOP_ID"
self.secretKey = secretKey ?? "–í–ê–®_TEST_SECRET_KEY"
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É: `5555 5555 5555 4444`
- CVV: `123`
- –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞

**–ì–æ—Ç–æ–≤–æ!** –ü–ª–∞—Ç–µ–∂–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –¥–µ–Ω—å–≥–∏ –Ω–µ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è.

---

## –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (1-3 –¥–Ω—è)

### 1. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

1. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–ò–ü/–û–û–û)
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏ (1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)
4. –ü–æ–¥–ø–∏—à–∏—Ç–µ –¥–æ–≥–æ–≤–æ—Ä

### 2. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏

1. –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Üí **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **API**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **shopId** –∏ **secretKey** (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `live_`)

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç –ê: Supabase Secrets (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

1. Supabase Dashboard ‚Üí Settings ‚Üí Edge Functions ‚Üí Secrets
2. –î–æ–±–∞–≤—å—Ç–µ:
   - `YOOKASSA_SHOP_ID` = –≤–∞—à shopId
   - `YOOKASSA_SECRET_KEY` = –≤–∞—à secretKey

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –í –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∞)**

```swift
self.shopId = shopId ?? "–í–ê–®_REAL_SHOP_ID"
self.secretKey = secretKey ?? "–í–ê–®_REAL_SECRET_KEY"
```

‚ö†Ô∏è **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ Git!**

### 4. –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏

```swift
UserDefaults.standard.set(true, forKey: "useRealPayments")
```

### 5. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ webhook

```bash
cd ChallengeAppBackend/supabase
supabase functions deploy payment-webhook
```

### 6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ –ÆKassa

1. –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Üí **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
2. URL: `https://qvyxkbeafgarcjjppttd.supabase.co/functions/v1/payment-webhook`
3. –°–æ–±—ã—Ç–∏—è: `payment.succeeded`, `payment.canceled`

**–ì–æ—Ç–æ–≤–æ!** –ü–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. üéâ

---

## üìö –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

- **–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏**: `HOW_TO_GET_YOOKASSA_KEYS.md`
- **–ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: `YOOKASSA_SETUP_GUIDE.md`
- **–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: `PAYMENT_INTEGRATION_COMPLETE.md`
