# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ÆKassa

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook
- **–ë—ã–ª–æ**: HMAC-SHA256 —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–°—Ç–∞–ª–æ**: HMAC-SHA256 —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–ª—è API v3
- **–§–∞–π–ª**: `ChallengeAppBackend/supabase/edge-functions/payment-webhook/index.ts`

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–î–æ–±–∞–≤–ª–µ–Ω**: `onOpenURL` –≤ `ChallengeAppApp.swift`
- **–î–æ–±–∞–≤–ª–µ–Ω–∞**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `PaymentReturned` notification –≤ `PaymentView.swift`
- **–î–æ–±–∞–≤–ª–µ–Ω–∞**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –≤ webhook
- **–î–æ–±–∞–≤–ª–µ–Ω–∞**: —Ñ—É–Ω–∫—Ü–∏—è `initiateRefund` –¥–ª—è –≤—ã–∑–æ–≤–∞ API –ÆKassa
- **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è**: –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —á–µ–ª–ª–µ–Ω–¥–∂ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

### 4. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ waiting_for_capture
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω—ã–π capture
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —Å `capture: true` —ç—Ç–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ ChallengeManager
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ—Ç–æ–∫–æ–ª —Ç—Ä–µ–±—É–µ—Ç `forceRefresh: Bool`, –Ω–æ –º–µ—Ç–æ–¥—ã –±—ã–ª–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –í—Å–µ –º–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ –∫–æ–¥)

1. **URL scheme –≤ Xcode**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ Info ‚Üí URL Types (–¥–æ–±–∞–≤–∏—Ç—å `challengeapp`)
2. **Webhook URL –≤ –ÆKassa**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
3. **–†–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏**: –ü–æ–ª—É—á–∏—Ç—å –æ—Ç –ÆKassa –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è HMAC-SHA256 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è API v3)
- URL scheme –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Xcode —á–µ—Ä–µ–∑ UI, –Ω–µ —á–µ—Ä–µ–∑ Info.plist
- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏—é
