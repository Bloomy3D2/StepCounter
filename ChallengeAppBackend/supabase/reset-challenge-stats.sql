-- ============================================
-- Сброс статистики по челленджам
-- ============================================
-- Выполните в Supabase SQL Editor (Dashboard → SQL Editor → New query)
--
-- ВНИМАНИЕ: Скрипт удаляет/обнуляет данные. Сделайте бэкап при необходимости.
-- После выполнения очистите кэш в приложении (перезапуск или pull-to-refresh).
-- ============================================

BEGIN;

-- --------------------------------------------
-- 1. Удалить все выполненные дни (completed_days)
-- --------------------------------------------
DELETE FROM public.completed_days;

-- --------------------------------------------
-- 2. Удалить все участия в челленджах (user_challenges)
-- --------------------------------------------
DELETE FROM public.user_challenges;

-- --------------------------------------------
-- 3. Сбросить счётчики в челленджах (challenges)
-- --------------------------------------------
UPDATE public.challenges
SET
    active_participants = 0,
    participants = 0,
    prize_pool = 0.0,
    updated_at = NOW();

-- --------------------------------------------
-- 4. (Опционально) Сбросить баланс и честную серию у пользователей
-- --------------------------------------------
-- Раскомментируйте блок ниже, если нужно обнулить баланс и honest_streak:

-- UPDATE public.users
-- SET
--     balance = 0.0,
--     honest_streak = 0,
--     updated_at = NOW();

-- --------------------------------------------
-- 5. (Опционально) Очистить историю платежей
-- --------------------------------------------
-- Раскомментируйте блок ниже, если нужно удалить все записи о платежах:

-- DELETE FROM public.payments;

COMMIT;

-- ============================================
-- Проверка после сброса (должно быть: 0, 0, N челленджей)
-- ============================================
SELECT 'completed_days' AS tbl, COUNT(*) AS cnt FROM public.completed_days
UNION ALL
SELECT 'user_challenges', COUNT(*) FROM public.user_challenges
UNION ALL
SELECT 'challenges', COUNT(*) FROM public.challenges;
